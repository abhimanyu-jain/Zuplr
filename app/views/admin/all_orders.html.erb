<style>
	table, th, td {
		border: 1px solid black;
	}

	th, td {
		padding: 10px;
	}
</style>

<script>
	$(function() {
		//$(".newcomment").on("click", function(event) {
		
		//});
	}); 
	
	function updatecomment(order_id) {
			index = "#stylist-comment" + order_id;
			comment = String($(index).val());
			event.preventDefault();
			$.ajax({
				type : "POST",
				url : "/admin/updatecomment",
				data : {
					order_id : order_id,
					stylistcomment : comment
				},
				success : function(result) {
					$(index).val(comment);
				},
			});
		}
		
		function update_order_status(order_id, status)
		{
			$.ajax({
				type : "POST",
				url : "/admin/update_order_status",
				data : {
					order_id : order_id,
					order_status : status
				},
				success : function(result) {
					index = "#status"+order_id;
					$(index).html(status);
					location.reload();
				},
			});
		}
	
</script>

<div style="padding-top:120px" class="container">
	<h2>All Orders</h2>
	<br />
	<br />

	<table border="3">
		<thead>
			<tr>
				<th>User</th>
				<th width="200">Created On</th>
				<th width="200">Updated On</th>
				<th width="125">Order Code </th>
				<th>Order Status</th>
				<th width="200">Delivery Date</th>
				<th width="300">Stylist Comments</th>
			</tr>
		</thead>

		<tbody>
			<% @orders.each do |order| %>
			<tr>
				<td>Email : <%= order.email %><br /><br />Phone : <%= order.phonenumber %><br /><br />Address : <%= order.address %> <br />Pincode : <%= order.pincode %><br /><br /> <%= link_to "User Profile", "/admin/userprofile/"+(order.userprofile_id).to_s %></td>
				<td><%= order.created_at.to_date.to_s + " " +  order.created_at.to_s(:time) %></td>
				<td><%= order.updated_at.to_date.to_s + " " +  order.updated_at.to_s(:time) %></td>
				<td><%= order.order_code %></td>
				<td>
					<div id = "status<%= order.id %>"><%= order.status%></div><br />
					<% if order.status == 'REQUESTED' %>
					<input class="btn btn-primary" type="button" value="Mark Box Ready" onclick="update_order_status(<%= order.id %>, 'BOX READY')" />
					<br />
					<input class="btn btn-danger" type="button" value="Cancel Order" onclick="update_order_status(<%= order.id %>, 'CANCELLED')" />
					<% elsif order.status == 'BOX READY' %>
					<input class="btn btn-primary" type="button" value="Box Dispatched" onclick="update_order_status(<%= order.id %>, 'DISPATCHED')" />
					<br />
					<input class="btn btn-danger" type="button" value="Cancel Order" onclick="update_order_status(<%= order.id %>, 'CANCELLED')" />
					<% elsif order.status == 'DISPATCHED' %>
					<input class="btn btn-primary" type="button" value="Box Delivered" onclick="update_order_status(<%= order.id %>, 'DELIVERED')" />
					<% elsif order.status == 'DELIVERED' %>
					<input class="btn btn-primary" type="button" value="Reverse Pickup Done" onclick="update_order_status(<%= order.id %>, 'PICKUP COMPLETED')" />
					<br />
					<input class="btn btn-success" type="button" value="Complete Order" onclick="update_order_status(<%= order.id %>, 'COMPLETED')" />
					<% elsif order.status == 'PICKUP COMPLETED' %>
					<input class="btn btn-success" type="button" value="Complete Order" onclick="update_order_status(<%= order.id %>, 'COMPLETED')" />
					<% end %>
				</td>
				<td><%= order.scheduleddeliverydate %></td>
				<td>
				<form>
					<textarea id="stylist-comment<%= order.id %>" style="width : 300px;" rows=10 value=""><%= order.stylist_comments %></textarea>
					<input class="newcomment" type="button" value="Update" onclick="updatecomment(<%= order.id %>)" />
				</form>
				</td>
			</tr>
			<% end %>
		</tbody>
	</table>
	
	<%= will_paginate @orders %>

</div>

